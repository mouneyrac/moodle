YUI.add("moodle-assignfeedback_editpdf-editor",function(e,t){var n=M.cfg.wwwroot+"/mod/assign/feedback/editpdf/ajax.php",r={DIALOGUE:"assignfeedback_editpdf_widget"},i={PREVIOUSBUTTON:"."+r.DIALOGUE+" .navigate-previous-button",NEXTBUTTON:"."+r.DIALOGUE+" .navigate-next-button",PAGESELECT:"."+r.DIALOGUE+" .navigate-page-select",LOADINGICON:"."+r.DIALOGUE+" .loading",DRAWINGREGION:"."+r.DIALOGUE+" .drawingregion",DRAWINGCANVAS:"."+r.DIALOGUE+" .drawingcanvas",CANCEL:"."+r.DIALOGUE+" .cancelbutton",SAVE:"."+r.DIALOGUE+" .savebutton",COMMENTCOLOURBUTTON:"."+r.DIALOGUE+" .commentcolourbutton",COMMENTMENU:" .commentdrawable a",ANNOTATIONCOLOURBUTTON:"."+r.DIALOGUE+" .annotationcolourbutton",STAMPSBUTTON:"."+r.DIALOGUE+" .currentstampbutton",DIALOGUE:"."+r.DIALOGUE},s={white:"rgb(255,255,255)",yellow:"rgb(255,255,176)",red:"rgb(255,176,176)",green:"rgb(176,255,176)",blue:"rgb(208,208,255)",clear:"rgba(255,255,255, 0)"},o={white:"rgb(255,255,255)",yellow:"rgb(255,255,0)",red:"rgb(255,0,0)",green:"rgb(0,255,0)",blue:"rgb(0,0,255)",black:"rgb(0,0,0)"},u=300,a={comment:"."+r.DIALOGUE+" .commentbutton",pen:"."+r.DIALOGUE+" .penbutton",line:"."+r.DIALOGUE+" .linebutton",rectangle:"."+r.DIALOGUE+" .rectanglebutton",oval:"."+r.DIALOGUE+" .ovalbutton",stamp:"."+r.DIALOGUE+" .stampbutton",select:"."+r.DIALOGUE+" .selectbutton"},f=4;Drawable=function(){this.shapes=[],this.nodes=[]},EDITOR=function(){EDITOR.superclass.constructor.apply(this,arguments)},EDITOR.prototype={dialogue:null,pagecount:0,currentpage:0,pages:[],loadingicon:null,pageimage:null,graphic:null,currentcommentcolour:"yellow",currentannotationcolour:"red",currenttool:"comment",currentedit:{},currentdrawable:!1,drawables:[],currentcolourpicker:null,commentmenu:null,currentcomment:null,currentcommentmenulink:null,currentpenposition:{x:null,y:null},currentpenpath:[],initializer:function(){var t,n;t=e.one("#"+this.get("linkid")),t.on("click",this.link_handler,this),t.on("key",this.link_handler,"down:13",this),n=e.one("#"+this.get("deletelinkid")),n.on("click",this.delete_link_handler,this),n.on("key",this.delete_link_handler,"down:13",this),this.currentedit.start=!1,this.currentedit.end=!1},refresh_button_state:function(){var t,n;t=e.one(i.COMMENTCOLOURBUTTON),t.setStyle("backgroundImage","none"),t.setStyle("background",s[this.currentcommentcolour]),this.currentcommentcolour==="clear"?t.setStyle("borderStyle","dashed"):t.setStyle("borderStyle","solid"),t=e.one(i.ANNOTATIONCOLOURBUTTON),t.setStyle("backgroundImage","none"),t.setStyle("backgroundColor",o[this.currentannotationcolour]),this.currenttool==="comment"?(t=e.one(i.COMMENTCOLOURBUTTON),t.show(),t=e.one(i.ANNOTATIONCOLOURBUTTON),t.hide(),t=e.one(i.STAMPSBUTTON),t.hide()):this.currenttool==="stamp"?(t=e.one(i.COMMENTCOLOURBUTTON),t.hide(),t=e.one(i.ANNOTATIONCOLOURBUTTON),t.hide(),t=e.one(i.STAMPSBUTTON),t.show()):(t=e.one(i.COMMENTCOLOURBUTTON),t.hide(),t=e.one(i.ANNOTATIONCOLOURBUTTON),t.show(),t=e.one(i.STAMPSBUTTON),t.hide()),n=e.one(a[this.currenttool]),n.addClass("assignfeedback_editpdf_selectedbutton"),n.setAttribute("aria-pressed","true")},link_handler:function(t){var n,s;t.preventDefault(),this.dialogue?this.dialogue.show():(this.dialogue=new M.core.dialogue({headerContent:this.get("header"),bodyContent:this.get("body"),footerContent:this.get("footer"),width:"840px",visible:!0}),this.dialogue.centerDialogue(),this.dialogue.get("boundingBox").addClass(r.DIALOGUE),this.loadingicon=e.one(i.LOADINGICON),n=e.one(i.DRAWINGCANVAS),this.graphic=new e.Graphic({render:i.DRAWINGCANVAS}),n.on("gesturemovestart",this.edit_start,null,this),n.on("gesturemove",this.edit_move,null,this),n.on("gesturemoveend",this.edit_end,null,this),s=e.one(i.DRAWINGREGION),s.delegate("click",this.open_comment_menu,i.COMMENTMENU,this),s.delegate("key",this.open_comment_menu,"down:13",i.COMMENTMENU,this),this.refresh_button_state()),this.load_all_pages()},delete_link_handler:function(t){var r,i;t.preventDefault();var s=n,o;o={method:"get",context:this,sync:!1,data:{sesskey:M.cfg.sesskey,action:"deletefeedbackdocument",userid:this.get("userid"),attemptnumber:this.get("attemptnumber"),assignmentid:this.get("assignmentid")},on:{success:function(){r=e.one("#"+this.get("downloadlinkid")),i=e.one("#"+this.get("deletelinkid")),r.addClass("hidden"),i.addClass("hidden")},failure:function(e,t){return M.core.exception(t.responseText)}}},e.io(s,o)},load_all_pages:function(){var t=n,r;r={method:"get",context:this,sync:!1,data:{sesskey:M.cfg.sesskey,action:"loadallpages",userid:this.get("userid"),attemptnumber:this.get("attemptnumber"),assignmentid:this.get("assignmentid")},on:{success:function(e,t){this.all_pages_loaded(t.responseText)},failure:function(e,t){return M.core.exception(t.responseText)}}},e.io(t,r)},all_pages_loaded:function(t){var n;try{n=e.JSON.parse(t)}catch(r){return this.dialogue.hide(),new M.core.exception(r)}this.pagecount=n.pagecount,this.pages=n.pages,this.setup_navigation(),this.change_page(),this.setup_save_cancel(),this.setup_toolbar()},setup_colour_picker:function(t,n,r){var i=e.Node.create('<ul role="menu" class="assignfeedback_editpdf_menu"/>'),s,o,u,a;e.each(n,function(t,n){var r,s;r=e.Node.create("<button/>"),r.setAttribute("title",M.util.get_string(n,"assignfeedback_editpdf")),r.setAttribute("data-colour",n),r.setAttribute("data-rgb",t),r.addClass("colour_"+n),r.setStyle("backgroundImage","none"),r.setStyle("background",t),n==="clear"?r.setStyle("borderStyle","dashed"):r.setStyle("borderStyle","solid"),s=e.Node.create("<li/>"),s.append(r),i.append(s)},this),o=e.Node.create("<div/>"),i.delegate("click",r,"button",this),i.delegate("key",r,"down:13","button",this),u=e.Node.create("<h3/>"),u.addClass("accesshide"),u.setHTML(M.util.get_string("colourpicker","assignfeedback_editpdf")),o.append(u),o.append(i),s=new M.core.dialogue({extraClasses:["assignfeedback_editpdf_colourpicker"],draggable:!1,centered:!1,width:"auto",lightbox:!1,visible:!1,bodyContent:o,footerContent:"",align:{node:t,points:[e.WidgetPositionAlign
.TL,e.WidgetPositionAlign.BL]}}),o.on("clickoutside",function(e){e.target!==t&&e.target.ancestor()!==t&&(e.preventDefault(),s.hide())}),a=function(){this.currentcolourpicker=s,s.show()},t.on("click",a,this),t.on("key",a,"down:13",this)},setup_toolbar:function(){var t,n,r;e.each(a,function(n,r){t=e.one(n),t.on("click",this.handle_toolbutton,this,r),t.on("key",this.handle_toolbutton,"down:13",this,r),t.setAttribute("aria-pressed","false")},this),n=e.one(i.COMMENTCOLOURBUTTON),this.setup_colour_picker(n,s,function(e){this.currentcommentcolour=e.target.getAttribute("data-colour"),this.refresh_button_state(),this.currentcolourpicker.hide()}),r=e.one(i.ANNOTATIONCOLOURBUTTON),this.setup_colour_picker(r,o,function(e){this.currentannotationcolour=e.target.getAttribute("data-colour"),this.refresh_button_state(),this.currentcolourpicker.hide()})},handle_toolbutton:function(t,n){var r;t.preventDefault(),r=e.one(a[this.currenttool]),r.removeClass("assignfeedback_editpdf_selectedbutton"),r.setAttribute("aria-pressed","false"),this.currenttool=n,this.refresh_button_state()},changecolor:function(t,n,r,s){var o,u;o=M.cfg.wwwroot+"/theme/image.php?theme=standard&component=assignfeedback_editpdf&image=",e.one(".pdfbutton_colour").get("childNodes").item(0).setAttribute("src",o+n),r.currentcolour=n,u=e.one(i.COLOURBUTTON),u.setAttribute("title",M.util.get_string(n,"assignfeedback_editpdf")),s.hide(),u.focus()},setup_save_cancel:function(){var t,n;t=e.one(i.CANCEL),n=e.one(i.SAVE),t.on("mousedown",this.handle_cancel,this),t.on("key",this.handle_cancel,"down:13",this),t.removeAttribute("disabled"),n.on("mousedown",this.handle_save,this),n.on("key",this.handle_save,"down:13",this),n.removeAttribute("disabled")},handle_cancel:function(e){e.preventDefault(),this.dialogue.hide()},stringify_current_page:function(){var t=[],n=[],r,i=0;for(i=0;i<this.pages[this.currentpage].comments.length;i++)t[i]=this.clean_comment_data(this.pages[this.currentpage].comments[i]);for(i=0;i<this.pages[this.currentpage].annotations.length;i++)n[i]=this.clean_annotation_data(this.pages[this.currentpage].annotations[i]);return r={comments:t,annotations:n},e.JSON.stringify(r)},handle_save:function(t){t.preventDefault();var r=n,i;i={method:"post",context:this,sync:!1,data:{sesskey:M.cfg.sesskey,action:"generatepdf",userid:this.get("userid"),attemptnumber:this.get("attemptnumber"),assignmentid:this.get("assignmentid")},on:{success:function(t,n){var r,i,s,o;try{r=e.JSON.parse(n.responseText);if(r.error)return new M.core.ajaxException(r);r.url&&(i=e.one("#"+this.get("downloadlinkid")),o=e.one("#"+this.get("downloadlinkid")+" span"),s=e.one("#"+this.get("deletelinkid")),o.setHTML(r.filename),i.setAttribute("href",r.url),i.removeClass("hidden"),s.removeClass("hidden")),this.dialogue.hide()}catch(u){return new M.core.exception(u)}},failure:function(e,t){return M.core.exception(t.responseText)}}},e.io(r,i)},edit_start:function(t){var n=e.one(i.DRAWINGCANVAS).getXY(),r=document.body.scrollTop,s=document.body.scrollLeft,o={x:t.clientX-n[0]+s,y:t.clientY-n[1]+r};if(this.currentedit.starttime)return;this.currentedit.starttime=(new Date).getTime(),this.currentedit.start=o,this.currentedit.end={x:o.x,y:o.y}},get_current_drawable:function(){var t=new Drawable,n,r,i,u,a;if(!this.currentedit.start||!this.currentedit.end)return!1;if(this.currenttool==="pen"){n=this.graphic.addShape({type:e.Path,fill:{color:o[this.currentannotationcolour]},stroke:{weight:f,color:o[this.currentannotationcolour]}});if(!this.currentpenposition.x||!this.currentpenposition.y||this.currentpenposition.x!==this.currentedit.end.x||this.currentpenposition.y!==this.currentedit.end.y){this.currentpenpath.length===0&&this.currentpenpath.push({x:this.currentedit.start.x,y:this.currentedit.start.y}),this.currentpenpath.push({x:this.currentedit.end.x,y:this.currentedit.end.y});var l={x:null,y:null};e.each(this.currentpenpath,function(e){l.x||(l.x=this.currentedit.start.x,l.y=this.currentedit.start.y),n.moveTo(l.x,l.y),n.lineTo(e.x,e.y),l.x=e.x,l.y=e.y},this),n.end(),this.currentpenposition.x=this.currentedit.end.x,this.currentpenposition.y=this.currentedit.end.y}}if(this.currenttool==="comment"||this.currenttool==="rectangle"||this.currenttool==="oval")u=this.currentedit.start.x,this.currentedit.end.x>u?r=this.currentedit.end.x-u:(u=this.currentedit.end.x,r=this.currentedit.start.x-u),a=this.currentedit.start.y,this.currentedit.end.y>a?i=this.currentedit.end.y-a:(a=this.currentedit.end.y,i=this.currentedit.start.y-a);this.currenttool==="comment"&&(n=this.graphic.addShape({type:e.Rect,width:r,height:i,fill:{color:s[this.currentcommentcolour]},x:u,y:a})),this.currenttool==="line"&&(n=this.graphic.addShape({type:e.Path,fill:{color:o[this.currentannotationcolour]},stroke:{weight:f,color:o[this.currentannotationcolour]}}),n.moveTo(this.currentedit.start.x,this.currentedit.start.y),n.lineTo(this.currentedit.end.x,this.currentedit.end.y),n.end());if(this.currenttool==="rectangle"||this.currenttool==="oval")this.currenttool==="rectangle"&&(tooltype=e.Rect),this.currenttool==="oval"&&(tooltype=e.Ellipse),n=this.graphic.addShape({type:tooltype,width:r,height:i,stroke:{weight:f,color:o[this.currentannotationcolour]},x:u,y:a});return t.shapes.push(n),t},erase_drawable:function(e){if(!e)return;if(e.shapes)while(e.shapes.length>0)this.graphic.removeShape(e.shapes.pop());if(e.nodes)while(e.nodes.length>0)e.nodes.pop().remove()},redraw_current_edit:function(){this.currentdrawable&&this.erase_drawable(this.currentdrawable),this.currentdrawable=this.get_current_drawable()},edit_move:function(t){var n=e.one(i.DRAWINGCANVAS).getXY(),r=document.body.scrollTop,s=document.body.scrollLeft,o={x:t.clientX-n[0]+s,y:t.clientY-n[1]+r};this.currentedit.start&&(this.currentedit.end=o,this.redraw_current_edit())},clean_comment_data:function(e){return{gradeid:e.gradeid,x:e.x,y:e.y,width:e.width,rawtext:e.rawtext,pageno:e.currentpage,colour:e.colour}},clean_annotation_data:function(e){return{gradeid:e.gradeid,x:e.x,y:e.y,endx
:e.endx,endy:e.endy,type:e.type,path:e.path,pageno:e.pageno,colour:e.colour}},edit_end:function(){var t,n,r,i,s,o,a;o=(new Date).getTime()-this.currentedit.start;if(o<u||this.currentedit.start===!1)return;this.currenttool==="comment"?(i=this.currentedit.start.x,this.currentedit.end.x>i?n=this.currentedit.end.x-i:(i=this.currentedit.end.x,n=this.currentedit.start.x-i),s=this.currentedit.start.y,this.currentedit.end.y>s?r=this.currentedit.end.y-s:(s=this.currentedit.end.y,r=this.currentedit.start.y-s),n<100&&(n=100),t={gradeid:this.get("gradeid"),x:i,y:s,width:n,rawtext:"",pageno:this.currentpage,colour:this.currentcommentcolour},this.pages[this.currentpage].comments.push(t),this.drawables.push(this.draw_comment(t,!0)),this.erase_drawable(this.currentdrawable)):this.currenttool==="pen"?(a="",e.each(this.currentpenpath,function(e){a=a+e.x+","+e.y+":"},this),a=a.substring(0,a.length-1),t={gradeid:this.get("gradeid"),path:a,type:"pen",pageno:this.currentpage,colour:this.currentannotationcolour},this.pages[this.currentpage].annotations.push(t),this.currentpenposition.x=null,this.currentpenposition.y=null,this.currentpenpath=[]):(t={gradeid:this.get("gradeid"),x:this.currentedit.start.x,y:this.currentedit.start.y,endx:this.currentedit.end.x,endy:this.currentedit.end.y,type:this.currenttool,pageno:this.currentpage,colour:this.currentannotationcolour},this.pages[this.currentpage].annotations.push(t)),this.save_current_page(),this.currentedit.starttime=0,this.currentedit.start=!1,this.currentedit.end=!1,this.currentdrawable=!1},save_current_page:function(){var t=n,r;r={method:"post",context:this,sync:!1,data:{sesskey:M.cfg.sesskey,action:"savepage",index:this.currentpage,userid:this.get("userid"),attemptnumber:this.get("attemptnumber"),assignmentid:this.get("assignmentid"),page:this.stringify_current_page()},on:{success:function(t,n){var r;try{r=e.JSON.parse(n.responseText);if(r.error)return new M.core.ajaxException(r)}catch(i){return new M.core.exception(i)}},failure:function(e,t){return M.core.exception(t.responseText)}}},e.io(t,r)},draw_annotation:function(t){var n,r,i,s,u,a,l,c,h;n=new Drawable,t.type==="line"&&(shape=this.graphic.addShape({type:e.Path,fill:{color:o[t.colour]},stroke:{weight:f,color:o[t.colour]}}),shape.moveTo(t.x,t.y),shape.lineTo(t.endx,t.endy),shape.end()),t.type==="pen"&&(shape=this.graphic.addShape({type:e.Path,fill:{color:o[t.colour]},stroke:{weight:f,color:o[t.colour]}}),r=t.path.split(":"),i={x:null,y:null},e.each(r,function(e){s=e.split(","),i.x||(i.x=s[0],i.y=s[1]),shape.moveTo(i.x,i.y),shape.lineTo(s[0],s[1]),i.x=s[0],i.y=s[1]},this),shape.end());if(t.type==="rectangle"||t.type==="oval")t.type==="rectangle"&&(h=e.Rect),t.type==="oval"&&(h=e.Ellipse),t.x=parseInt(t.x,10),t.y=parseInt(t.y,10),t.endx=parseInt(t.endx,10),t.endy=parseInt(t.endy,10),l=t.x,t.endx>l?u=t.endx-l:(l=t.endx,u=t.x-l),c=t.y,t.endy>c?a=t.endy-c:(c=t.endy,a=t.y-c),shape=this.graphic.addShape({type:h,width:u,height:a,stroke:{weight:f,color:o[t.colour]},x:l,y:c});return n.shapes.push(shape),n},delete_comment:function(e){var t=0,n;n=this.pages[this.currentpage].comments;for(t=0;t<n.length;t++)if(n[t]===e){n.splice(t,1),this.erase_drawable(e.drawable),this.save_current_page();return}},draw_comment:function(t,n){var r=new Drawable,o,u=e.one(i.DRAWINGREGION),a=e.one(i.DRAWINGCANVAS).getXY(),f=e.one(i.DIALOGUE).getXY(),l=a[0]-f[0],c=a[1]-f[1],h,p;return o=e.Node.create("<textarea/>"),h=e.Node.create('<div class="commentdrawable"/>'),p=e.Node.create('<a href="#"><img src="'+this.get("menuicon")+'"/></a>'),h.append(o),h.append(p),t.width<100&&(t.width=100),h.setStyles({position:"absolute",left:parseInt(t.x,10)+l+"px",top:parseInt(t.y,10)+c+"px"}),o.setStyles({width:t.width+"px",backgroundColor:s[t.colour]}),u.append(h),r.nodes.push(h),o.set("value",t.rawtext),o.setStyle("height",o.get("scrollHeight")-8+"px"),this.attach_comment_events(t,o,p),n&&o.focus(),t.drawable=r,r},open_comment_menu:function(t){var n=t.target,r=t.target.getData("comment"),i,s;this.commenttodelete=null,r||(n=n.ancestor(),r=n.getData("comment")),this.currentcomment=r,this.currentcommentmenulink=n,this.commentmenu?this.commentmenu.align(n,[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]):(i=e.Node.create('<ul role="menu" class="assignfeedback_editpdf_menu"/>'),s=e.Node.create('<li><a tabindex="-1" href="#">'+M.util.get_string("addtoquicklist","assignfeedback_editpdf")+"</a></li>"),s.on("click",function(){this.commentmenu.hide()},this),s.on("key",function(){this.commentmenu.hide()},"enter,space",this),i.append(s),s=e.Node.create('<li><a tabindex="-1" href="#">'+M.util.get_string("deletecomment","assignfeedback_editpdf")+"</a></li>"),s.on("click",function(){this.commentmenu.hide(),this.delete_comment(this.currentcomment)},this),s.on("key",function(){this.commentmenu.hide(),this.delete_comment(this.currentcomment)},"enter,space",this),i.append(s),this.commentmenu=new M.core.dialogue({extraClasses:["assignfeedback_editpdf_commentmenu"],draggable:!1,centered:!1,lightbox:!1,width:"auto",visible:!1,bodyContent:i,footerContent:"",align:{node:n,points:[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]}}),i.on("clickoutside",function(e){e.target!==this.currentcommentmenulink&&e.target.ancestor()!==this.currentcommentmenulink&&(e.preventDefault(),this.commentmenu.hide())},this)),this.commentmenu.show()},delete_comment_later:function(){this.commenttodelete!==null&&this.delete_comment(this.commenttodelete)},attach_comment_events:function(t,n,r){n.on("blur",function(){t.rawtext=n.get("value"),t.width=parseInt(n.getStyle("width"),10),t.rawtext.replace(/^\s+|\s+$/g,"")===""&&(this.commenttodelete=t,e.later(400,this,this.delete_comment_later)),this.save_current_page()},this),r.setData("comment",t),n.on("keyup",function(){var e=n.get("scrollHeight")-8;this.setStyle("height",e+"px")}),n.on("gesturemovestart",function(e){n.setData("dragging",!0),n.setData("offsetx",e.clientX-n.getX()),n.setData("offsety",e.clientY-n.getY())}),n.on("gesturemoveend",function(
){n.setData("dragging",!1),this.save_current_page()},null,this),n.on("gesturemove",function(r){var s=r.clientX-n.getData("offsetx"),o=r.clientY-n.getData("offsety"),u=e.one(i.DRAWINGCANVAS),a=u.getXY(),f,l,c,h,p=a[0],d=a[1];f=parseInt(u.getStyle("width"),10),l=parseInt(u.getStyle("height"),10),c=parseInt(n.getStyle("width"),10),h=parseInt(n.getStyle("height"),10),s<p&&(s=p),o<d&&(o=d),s-p+c>f&&(s=p+f-c),o-d+h>l&&(o=d+l-h),t.x=s-p,t.y=o-d,n.ancestor().setX(s),n.ancestor().setY(o)})},redraw:function(){var e,t;t=this.pages[this.currentpage];while(this.drawables.length>0)this.erase_drawable(this.drawables.pop());for(e=0;e<t.annotations.length;e++)this.drawables.push(this.draw_annotation(t.annotations[e]));for(e=0;e<t.comments.length;e++)this.drawables.push(this.draw_comment(t.comments[e],!1))},change_page:function(){var t=e.one(i.DRAWINGCANVAS),n,r,s;r=e.one(i.PREVIOUSBUTTON),s=e.one(i.NEXTBUTTON),this.currentpage>0?r.removeAttribute("disabled"):r.setAttribute("disabled","true"),this.currentpage<this.pagecount-1?s.removeAttribute("disabled"):s.setAttribute("disabled","true"),n=this.pages[this.currentpage],this.loadingicon.hide(),t.setStyle("backgroundImage",'url("'+n.url+'")'),this.redraw()},setup_navigation:function(){var t,n,r,s,o;t=e.one(i.PAGESELECT),options=t.all("option");if(options.size()<=1)for(n=0;n<this.pages.length;n++)r=e.Node.create("<option/>"),r.setAttribute("value",n),r.setHTML(n+1),t.append(r);t.removeAttribute("disabled"),t.on("change",function(){this.currentpage=t.get("value"),this.change_page()},this),s=e.one(i.PREVIOUSBUTTON),o=e.one(i.NEXTBUTTON),s.on("click",this.previous_page,this),s.on("key",this.previous_page,"down:13",this),o.on("click",this.next_page,this),o.on("key",this.next_page,"down:13",this)},previous_page:function(){this.currentpage--,this.currentpage<0&&(this.currentpage=0),this.change_page()},next_page:function(){this.currentpage++,this.currentpage>=this.pages.length&&(this.currentpage=this.pages.length-1),this.change_page()}},e.extend(EDITOR,e.Base,EDITOR.prototype,{NAME:"moodle-assignfeedback_editpdf-editor",ATTRS:{userid:{validator:e.Lang.isInteger,value:0},assignmentid:{validator:e.Lang.isInteger,value:0},attemptnumber:{validator:e.Lang.isInteger,value:0},header:{validator:e.Lang.isString,value:""},body:{validator:e.Lang.isString,value:""},footer:{validator:e.Lang.isString,value:""},linkid:{validator:e.Lang.isString,value:""},deletelinkid:{validator:e.Lang.isString,value:""},downloadlinkid:{validator:e.Lang.isString,value:""},menuicon:{validator:e.Lang.isString,value:""}}}),M.assignfeedback_editpdf=M.assignfeedback_editpdf||{},M.assignfeedback_editpdf.editor=M.assignfeedback_editpdf.editor||{},M.assignfeedback_editpdf.editor.init=M.assignfeedback_editpdf.editor.init||function(e){return new EDITOR(e)}},"@VERSION@",{requires:["base","event","node","io","graphics","json","event-move","querystring-stringify-simple","moodle-core-notification-dialog","moodle-core-notification-exception","moodle-core-notification-ajaxexception"]});
